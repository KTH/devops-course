name: Checking the Word Count of Submitted Essay
'on':
  pull_request:
  workflow_dispatch: []
jobs:
  check-essay:
    runs-on: ubuntu-18.04
    if: ${{ contains(github.head_ref, 'essay-added') }}
    steps:
      - uses: actions/checkout@v2
      - name: Install xpdf
        run: sudo apt-get install -y xpdf
      - id: files
        uses: jitterbit/get-changed-files@v1
      - name: Check the submitted essays
        run: >
          for added_modified_file in ${{ steps.files.outputs.added_modified  }}; do
            echo "Checking file: $added_modified_file"
            if [[ "$added_modified_file" == *"contributions/essay/"* ]] && [[ "$added_modified_file" == *"pdf" ]] ; then
              words=$(sudo pdftotext $added_modified_file - | wc -w)
              echo "File $added_modified_file has $words words"
              if [ $words -lt 1800 ] || [ $words -gt 2200 ]; then
                exit 1
              fi
            fi
          done