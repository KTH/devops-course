name: Checking the Word Count of Submitted Essay
'on':
  pull_request:
  workflow_dispatch: []
jobs:
  check-essay:
    runs-on: ubuntu-18.04
    if: ${{ contains(github.head_ref, 'essay-submission') }}
    steps:
      - uses: actions/checkout@v2
      - name: Install xpdf
        run: sudo apt-get install -y xpdf
      - id: file_changes
        uses: trilom/file-changes-action@v1.2.3
      - name: Check the submitted essays
        run: >
          added_files=${{ steps.file_changes.outputs.files_added  }}
          for added_modified_file in ${added_files[@]}; do
            echo "Checking file: $added_modified_file"
            if [[ "$added_modified_file" == *"contributions/essay/"* ]] && [[ "$added_modified_file" == *"pdf" ]] ; then
              words=$(sudo pdftotext $added_modified_file - | wc -w)
              echo "File $added_modified_file has $words words"
              if [ $words -lt 1800 ] || [ $words -gt 2200 ]; then
                exit 1
              fi
            fi
          done