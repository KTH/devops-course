name: Checking the Word Count of Submitted Essay
'on':
  pull_request:
  workflow_dispatch: []
jobs:
  check-essay:
    runs-on: ubuntu-18.04
    steps:
      - uses: actions/checkout@v2
      - name: Install xpdf
        run: sudo apt-get install -y xpdf
      - id: file_changes
        uses: trilom/file-changes-action@v1.2.3
      - name: Check the submitted essays
        run: >
          added_files='${{ steps.file_changes.outputs.files_added  }}';
          added_files=${added_files//\"/ };
          added_files=${added_files/[/};
          added_files=${added_files/]/};
          added_files=${added_files// /;};
          added_files=${added_files//,/ };
          for item in ${added_files[@]}; do
            added_file=${item//;/ };
            echo "Checking file: $added_file"
            if [[ "$added_file" == *"contributions/essay/"* ]] && [[ "$added_file" == *"pdf"* ]] ; then
                #if [[ $added_file == *" "* ]]; then
                #  echo "The added file names should not contain whitespace"
                #  exit 1
                #fi;
              words=$(sudo pdftotext "${added_file}" - | wc -w)
              echo "File $added_file has $words words"
              if [ $words -lt 1800 ] || [ $words -gt 2200 ]; then
                exit 1
              fi
            fi
          done